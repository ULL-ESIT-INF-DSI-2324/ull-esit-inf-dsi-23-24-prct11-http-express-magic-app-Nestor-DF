<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>doc-test</title><meta name="description" content="Documentation for doc-test"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">doc-test</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>doc-test</h2></div><div class="tsd-panel tsd-typography"><a id="md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic" class="tsd-anchor"></a><h1><a href="#md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic">Práctica 10 - Aplicación cliente-servidor para coleccionistas de cartas Magic</a></h1><ul>
<li>Néstor Delgado Feliciano (<a href="mailto:alu0101488998@ull.edu.es">alu0101488998@ull.edu.es</a>)</li>
</ul>
<p><a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-Nestor-DF?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-Nestor-DF/badge.svg?branch=main" alt="Coverage Status"></a></p>
<p><a href="https://sonarcloud.io/summary/new_code?id=Nestor-DF_DSI-2023-2024-Practica10-PE-"><img src="https://sonarcloud.io/api/project_badges/measure?project=Nestor-DF_DSI-2023-2024-Practica10-PE-&metric=alert_status" alt="Quality Gate Status"></a></p>
<a id="md:índice" class="tsd-anchor"></a><h2><a href="#md:índice"><strong>Índice</strong></a></h2><ul>
<li><a href="#md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic">Práctica 10 - Aplicación cliente-servidor para coleccionistas de cartas Magic</a><ul>
<li><a href="#md:índice"><strong>Índice</strong></a></li>
<li><a href="#md:introducción"><strong>Introducción</strong></a></li>
<li><a href="#md:desarrollo"><strong>Desarrollo</strong></a></li>
<li><a href="#md:conclusiones"><strong>Conclusiones</strong></a></li>
<li><a href="#md:recursos-empleados"><strong>Recursos Empleados</strong></a></li>
</ul>
</li>
</ul>
<a id="md:introducción" class="tsd-anchor"></a><h2><a href="#md:introducción"><strong>Introducción</strong></a></h2><p>En esta práctica se desarrollará una aplicación cliente-servidor para gestionar información sobre cartas del juego Magic: The Gathering. La aplicación permitirá llevar a cabo diversas operaciones desde el cliente, como añadir, modificar, eliminar, listar y leer la información asociada a estas cartas. Toda la información de cada carta se almacenará en formato JSON en el sistema de archivos del servidor. Además, se enfatiza que la interacción con la aplicación se realizará exclusivamente a través de la línea de comandos.</p>
<a id="md:desarrollo" class="tsd-anchor"></a><h2><a href="#md:desarrollo"><strong>Desarrollo</strong></a></h2><p>Partiendo de la clase que había creado en la la práctica anterior cambié todos los métodos síncronos por métodos <strong>asíncronos basados en callbacks</strong>:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">CardManager</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-2">static</span><span class="hl-1"> </span><span class="hl-4">instance</span><span class="hl-1">: </span><span class="hl-3">CardManager</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-2">constructor</span><span class="hl-1">() {}</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-2">static</span><span class="hl-1"> </span><span class="hl-5">getInstance</span><span class="hl-1">(): </span><span class="hl-3">CardManager</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">CardManager</span><span class="hl-1">.</span><span class="hl-4">instance</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">CardManager</span><span class="hl-1">.</span><span class="hl-4">instance</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-5">CardManager</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">CardManager</span><span class="hl-1">.</span><span class="hl-4">instance</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-5">addCard</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">, </span><span class="hl-4">card</span><span class="hl-1">: </span><span class="hl-3">MagiCard</span><span class="hl-1">, </span><span class="hl-5">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">userDirectory</span><span class="hl-1"> = </span><span class="hl-7">`./data/</span><span class="hl-2">${</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">cardFilePath</span><span class="hl-1"> = </span><span class="hl-7">`</span><span class="hl-2">${</span><span class="hl-4">userDirectory</span><span class="hl-2">}</span><span class="hl-7">/</span><span class="hl-2">${</span><span class="hl-4">card</span><span class="hl-8">.</span><span class="hl-5">getId</span><span class="hl-8">()</span><span class="hl-2">}</span><span class="hl-7">.json`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-5">mkdir</span><span class="hl-1">(</span><span class="hl-4">userDirectory</span><span class="hl-1">, { </span><span class="hl-4">recursive:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1"> }, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-4">err</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-5">stat</span><span class="hl-1">(</span><span class="hl-4">cardFilePath</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-5">writeFile</span><span class="hl-1">(</span><span class="hl-4">cardFilePath</span><span class="hl-1">, </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">), (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">              </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-4">err</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">              } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-2">undefined</span><span class="hl-1">, </span><span class="hl-7">`Card added in </span><span class="hl-2">${</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-7">&#39;s collection`</span><span class="hl-1">);</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">            });</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-7">`A card with the same ID already exists in </span><span class="hl-2">${</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-7">&#39;s collection`</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-5">updateCard</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">user</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">card</span><span class="hl-1">: </span><span class="hl-3">MagiCard</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">callback</span><span class="hl-1">: (</span><span class="hl-4">error</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1"> | </span><span class="hl-3">undefined</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-3">void</span><span class="hl-1">,</span><br/><span class="hl-1">  ): </span><span class="hl-3">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">cardFilePath</span><span class="hl-1"> = </span><span class="hl-7">`./data/</span><span class="hl-2">${</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-7">/</span><span class="hl-2">${</span><span class="hl-4">card</span><span class="hl-8">.</span><span class="hl-5">getId</span><span class="hl-8">()</span><span class="hl-2">}</span><span class="hl-7">.json`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-5">stat</span><span class="hl-1">(</span><span class="hl-4">cardFilePath</span><span class="hl-1">, (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-7">`Card not found at </span><span class="hl-2">${</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-7">&#39;s collection`</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">fs</span><span class="hl-1">.</span><span class="hl-5">writeFile</span><span class="hl-1">(</span><span class="hl-4">cardFilePath</span><span class="hl-1">, </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">), (</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-4">err</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">, </span><span class="hl-2">undefined</span><span class="hl-1">);</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-5">callback</span><span class="hl-1">(</span><span class="hl-2">undefined</span><span class="hl-1">, </span><span class="hl-7">`Card updated in </span><span class="hl-2">${</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-7">&#39;s collection`</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-9">// Demás código</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Se puede apreciar como uso el patrón de callbacks de tal manera que si hay un error la variable <em>error</em> contendrá una string con la descripción del error mientras <em>result</em> será undefined. Si todo va bien <em>error</em> contendrá undefined y <em>result</em> contendrá un mensaje con el resultado.</p>
<p>A continuación, modifiqué el programa pricipal para que actúe como cliente usando el módulo net de Node.js:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-4">net</span><span class="hl-1">.</span><span class="hl-5">connect</span><span class="hl-1">({ </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-10">60300</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">yargs</span><span class="hl-1">(</span><span class="hl-5">hideBin</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">argv</span><span class="hl-1">))</span><br/><span class="hl-1">  .</span><span class="hl-5">command</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">&#39;show&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">&#39;Show a card of the collection&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">user:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-7">&#39;user name&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-7">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">demandOption:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">id:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-7">&#39;Card ID&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-7">&#39;number&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">demandOption:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    (</span><span class="hl-4">argv</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">action:</span><span class="hl-1"> </span><span class="hl-7">&#39;show&#39;</span><span class="hl-1">, </span><span class="hl-4">user:</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">cardID:</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">close:</span><span class="hl-1"> </span><span class="hl-7">&#39;CLOSED&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">  .</span><span class="hl-5">help</span><span class="hl-1">().</span><span class="hl-4">argv</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Demás código para manejar las otras acciones</span><br/><br/><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">wholeData</span><span class="hl-1"> = </span><span class="hl-7">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-4">dataChunk</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">wholeData</span><span class="hl-1"> += </span><span class="hl-4">dataChunk</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;Received from server:</span><span class="hl-11">\n</span><span class="hl-7">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">answer</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-4">wholeData</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">receivedData</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">answer</span><span class="hl-1">.</span><span class="hl-4">status</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;Error&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">red</span><span class="hl-1">.</span><span class="hl-5">bold</span><span class="hl-1">(</span><span class="hl-4">answer</span><span class="hl-1">.</span><span class="hl-4">answer</span><span class="hl-1">));</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;Success&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">green</span><span class="hl-1">.</span><span class="hl-5">bold</span><span class="hl-1">(</span><span class="hl-4">answer</span><span class="hl-1">.</span><span class="hl-4">answer</span><span class="hl-1">));</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;CardsReceived&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-4">receivedData</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-4">answer</span><span class="hl-1">.</span><span class="hl-4">answer</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">receivedData</span><span class="hl-1">.</span><span class="hl-5">forEach</span><span class="hl-1">((</span><span class="hl-4">card</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-5">colorCard</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">));</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;Connection closed&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Se puede observar como uso la función connect del módulo net para conectarme al servidor a través del puerto 60300 y como se hace un <strong>client.write(data)</strong> dentro del manejador de comandos de yargs tras obtener la información y <em><strong>serializarla</strong></em> usando <strong>JSON.stringify</strong>. El resto de comandos siguen la misma la estructura.</p>
<p>Por otro lado, el cliente se encarga de reconstruir la respuesta del servidor en caso de que esta venga dada en <strong>varios</strong> eventos <em>data</em>. Cuando el servidor cierre la conexión tras enviar la respuesta el cliente la gestiona a través del evento <em>end</em> mostrando los resultados de la petición. Se distinguen tres casos claros que vienen dados por el campo <strong>status</strong> de la respuesta del servidor:</p>
<ul>
<li>Error: Ocurre cuando se produce un error en el servidor</li>
<li>Sucess: Ocurre cuando todo va bien en la petición</li>
<li>CardsReceived: Ocurre en los casos en los que la respuesta del servidor son cartas, es decir, cuando el cliente hace peticiones de <em>show</em> o <em>list</em> sobre su colección de cartas.</li>
</ul>
<p>Se recalca como el cliente procesa la <em><strong>respuesta</strong></em>, <strong>la cual es una representación en cadena de un objeto JSON válido</strong>, deserializándola primero con <strong>JSON.parse</strong> y después haciendo uso del paquete <strong>chalk</strong> para mostrar por consola los mensajes. Para mostrar las cartas se usan dos funciones específicas:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-5">formatCardString</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">): </span><span class="hl-3">string</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">JSONcard</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">content</span><span class="hl-1"> = </span><span class="hl-7">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`ID: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">id</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Name: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">name</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Mana cost: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">manaCost</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Color: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">color</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Type: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">type</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Rarity: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">rarity</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Rules text: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">rulesText</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Market value: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">marketValue</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">JSONcard</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-7">&#39;Creature&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Power/Toughness: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">powerAndToughness</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">JSONcard</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-7">&#39;Planeswalker&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">content</span><span class="hl-1"> += </span><span class="hl-7">`Loyalty: </span><span class="hl-2">${</span><span class="hl-4">JSONcard</span><span class="hl-8">.</span><span class="hl-4">loyaltyMarks</span><span class="hl-2">}</span><span class="hl-11">\n</span><span class="hl-7">`</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">content</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1"> </span><span class="hl-5">colorCard</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">): </span><span class="hl-3">string</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">JSONcard</span><span class="hl-1"> = </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">cardInfo</span><span class="hl-1"> = </span><span class="hl-5">formatCardString</span><span class="hl-1">(</span><span class="hl-4">card</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">JSONcard</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">White</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">white</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-5">italic</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">Blue</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">blue</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-5">italic</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">Black</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">black</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-5">italic</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">Red</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">red</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-5">italic</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">Green</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">green</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-5">italic</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">Colorless</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">gray</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-5">italic</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-4">Color</span><span class="hl-1">.</span><span class="hl-4">Multicolor</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">yellow</span><span class="hl-1">.</span><span class="hl-4">bold</span><span class="hl-1">.</span><span class="hl-4">italic</span><span class="hl-1">.</span><span class="hl-5">bgBlack</span><span class="hl-1">(</span><span class="hl-4">cardInfo</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-5">bold</span><span class="hl-1">(</span><span class="hl-7">&#39;Unknown color&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">} </span>
</code><button>Copy</button></pre>
<p>Ya yéndonos al lado del servidor, implementé una clase que <strong>hereda</strong> de <strong>EventEmitter</strong> para así poder emitir un evento propio <strong>request</strong> en el socket del servidor y detectar cuando un cliente ha enviado una petición completa.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">EventEmitterSocket</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">EventEmitter</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-4">connection</span><span class="hl-1">: </span><span class="hl-3">EventEmitter</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">wholeData</span><span class="hl-1"> = </span><span class="hl-7">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-4">dataChunk</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">wholeData</span><span class="hl-1"> += </span><span class="hl-4">dataChunk</span><span class="hl-1">;</span><br/><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;Received from client:&#39;</span><span class="hl-1">, </span><span class="hl-4">dataChunk</span><span class="hl-1">.</span><span class="hl-5">toString</span><span class="hl-1">());</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">wholeData</span><span class="hl-1">.</span><span class="hl-5">includes</span><span class="hl-1">(</span><span class="hl-7">&#39;CLOSED&quot;}&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-5">emit</span><span class="hl-1">(</span><span class="hl-7">&#39;request&#39;</span><span class="hl-1">, </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">parse</span><span class="hl-1">(</span><span class="hl-4">wholeData</span><span class="hl-1">), </span><span class="hl-4">connection</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-5">emit</span><span class="hl-1">(</span><span class="hl-7">&#39;close&#39;</span><span class="hl-1">, </span><span class="hl-4">connection</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>La manera más sencilla que se me ocurrió de detectar cuando un mensaje ya ha sido enviado por completo por el cliente fue añadirle un atributo CLOSED al final del json que envía el cliente. De esta forma cuando el servidor lea la cadena <strong>CLOSED&quot;}</strong> significa que ha llegado el final de la petición. Seguí la misma lógica que en el ejemplo de clase donde se usaba el caracter <strong>\n</strong> para detectar el final de una petición.</p>
<p>En lo que es el servidor en sí, lo creo con el método <strong>createServer</strong> de net y dentro de manejador uso el único parámetro <em>connection</em> que es un net.Socket (un EventEmitter) para pasárselo a la clase <strong>EventEmitterSocket</strong></p>
<p>Después, uso el objeto que me crea mi clase <strong>EventEmitterSocket</strong> para poder gestionar el evento <strong>request</strong>. Dentro del manejador de <strong>request</strong> tengo un <strong>switch</strong> que comprueba el campo <em><strong>request.action</strong></em> para así poder gestionar las distintas acciones posibles que puede realizar el servidor. Las acciones están encapsuladas en la clase <strong>CardManager</strong> que sigue el patrón <strong>callback</strong> en sus métodos. Al finalizar la ejecución de los manejadores y por tanto <strong>finalizar</strong> la <strong>respuesta</strong> del servidor se cierra el socket con un <strong>end()</strong> para <em>notificar al cliente de que la respuesta está completa.</em></p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">server</span><span class="hl-1"> = </span><span class="hl-4">net</span><span class="hl-1">.</span><span class="hl-5">createServer</span><span class="hl-1">((</span><span class="hl-4">connection</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;A client has connected.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">serverSocket</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-5">EventEmitterSocket</span><span class="hl-1">(</span><span class="hl-4">connection</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-4">serverSocket</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;close&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;A client has disconnected.</span><span class="hl-11">\n</span><span class="hl-7">&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-4">serverSocket</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-7">&#39;request&#39;</span><span class="hl-1">, (</span><span class="hl-4">request</span><span class="hl-1">, </span><span class="hl-4">connection</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">cardData</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-7">&#39;add&#39;</span><span class="hl-1"> || </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1"> === </span><span class="hl-7">&#39;update&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">cardData</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-5">MagiCard</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">manaCost</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">cardType</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">rarity</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">rulesText</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">marketValue</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">powerToughness</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">card</span><span class="hl-1">.</span><span class="hl-4">loyalty</span><span class="hl-1">,</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;Received request: &#39;</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">action</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;add&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">cardManager</span><span class="hl-1">.</span><span class="hl-5">addCard</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">cardData</span><span class="hl-1">!, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Error&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Success&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;update&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">cardManager</span><span class="hl-1">.</span><span class="hl-5">updateCard</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">cardData</span><span class="hl-1">!, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Error&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Success&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;remove&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">cardManager</span><span class="hl-1">.</span><span class="hl-5">removeCard</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">cardID</span><span class="hl-1">, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Error&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Success&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;show&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">cardManager</span><span class="hl-1">.</span><span class="hl-5">showCard</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">cardID</span><span class="hl-1">, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Error&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;CardsReceived&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-7">&#39;list&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">cardManager</span><span class="hl-1">.</span><span class="hl-5">listCollection</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, (</span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;Error&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1"> }));</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({ </span><span class="hl-4">status:</span><span class="hl-1"> </span><span class="hl-7">&#39;CardsReceived&#39;</span><span class="hl-1">, </span><span class="hl-4">answer:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> }));</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">write</span><span class="hl-1">(</span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;Invalid action&#39;</span><span class="hl-1">));</span><br/><span class="hl-1">        </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-5">end</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-5">listen</span><span class="hl-1">(</span><span class="hl-10">60300</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-7">&#39;Waiting for clients to connect.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones"><strong>Conclusiones</strong></a></h2><p>En conclusión, esta práctica me ha proporcionado una comprensión más profunda de las capacidades de Node.js, desde la manipulación de eventos asíncronos hasta la interacción con el sistema de archivos y la creación de aplicaciones de red, además de haber reforzado el uso de herramientas como yargs y chalk para mejorar la experiencia del usuario en la línea de comandos.</p>
<a id="md:recursos-empleados" class="tsd-anchor"></a><h2><a href="#md:recursos-empleados"><strong>Recursos Empleados</strong></a></h2><ol>
<li><p>OpenAI Chat: <a href="https://chat.openai.com/">https://chat.openai.com/</a> - Plataforma de IA conversacional proporcionada por OpenAI para tareas y aplicaciones de procesamiento de lenguaje natural.</p>
</li>
<li><p>W3Schools JavaScript Reference: <a href="https://www.w3schools.com/jsrEF/default.asp">https://www.w3schools.com/jsrEF/default.asp</a> - Recurso en línea completo para aprender y consultar conceptos, sintaxis y mejores prácticas del lenguaje de programación JavaScript.</p>
</li>
<li><p>MDN Web Docs - JavaScript Reference: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference</a> - Documentación oficial de la Red de Desarrolladores de Mozilla que proporciona explicaciones detalladas, ejemplos y referencias para las características del lenguaje JavaScript y las API.</p>
</li>
<li><p>API asíncrona proporcionada por Node.js para trabajar con el sistema de archivos: <a href="https://nodejs.org/docs/latest/api/fs.html">https://nodejs.org/docs/latest/api/fs.html</a></p>
</li>
<li><p>Yargs: <a href="https://www.npmjs.com/package/yargs">https://www.npmjs.com/package/yargs</a></p>
</li>
<li><p>Yargs: <a href="https://www.npmjs.com/package/yargs">https://www.npmjs.com/package/yargs</a></p>
</li>
</ol>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:práctica-10---aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic"><span>Práctica 10 -<wbr/> <wbr/>Aplicación cliente-<wbr/>servidor para coleccionistas de cartas <wbr/>Magic</span></a><ul><li><a href="#md:índice"><span>Índice</span></a></li><li><a href="#md:introducción"><span>Introducción</span></a></li><li><a href="#md:desarrollo"><span>Desarrollo</span></a></li><li><a href="#md:conclusiones"><span>Conclusiones</span></a></li><li><a href="#md:recursos-empleados"><span>Recursos <wbr/>Empleados</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>doc-test</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>